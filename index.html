<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Beranda - History Club SMAN 32 Jakarta</title>

  <!--
    components.js sudah inject:
    - Font Poppins
    - Remixicon
    - Base style (warna brand, header/footer, dll)
  -->

  <style>
    /* Style khusus Beranda (aman: tidak mengganggu style global dari components.js) */

    .home-wrap { width: 100%; }

    .section { margin-top: 46px; }
    .section-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--hc-dark);
      margin: 0 0 18px 0;
      text-align: center;
      letter-spacing: .01em;
    }

    /* HERO */
    .hero {
      background: linear-gradient(90deg, var(--hc-blue) 0%, var(--hc-toska) 100%);
      border-radius: 18px;
      padding: 52px 24px;
      color: #fff;
      text-align: center;
      box-shadow: 0 14px 34px rgba(26, 71, 135, 0.22);
      position: relative;
      overflow: hidden;
    }
    .hero::after{
      content:"";
      position:absolute;
      inset:-60px -80px auto auto;
      width:220px; height:220px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      filter: blur(2px);
      transform: rotate(10deg);
    }
    .hero-logo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 10px 30px rgba(0,0,0,.18);
      border: 2px solid rgba(255,255,255,.35);
      margin-bottom: 12px;
    }
    .hero-title {
      margin: 0;
      font-size: 34px;
      font-weight: 800;
      letter-spacing: .02em;
    }
    .hero-subtitle {
      margin: 10px 0 24px 0;
      font-size: 15px;
      opacity: 0.92;
    }
    .hero-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .hero-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 18px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 14px;
      text-decoration: none;
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
      user-select: none;
    }
    .hero-btn.primary {
      background: #fff;
      color: var(--hc-blue);
    }
    .hero-btn.secondary {
      background: rgba(255,255,255,.14);
      color: #fff;
      border: 1px solid rgba(255,255,255,.22);
    }
    .hero-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(0,0,0,.12);
    }

    /* STATS */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 14px;
      text-align: center;
    }
    .stat-card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 14px;
      padding: 18px 14px;
      box-shadow: 0 6px 18px rgba(15, 23, 42, .05);
    }
    .stat-number {
      font-size: 34px;
      font-weight: 800;
      color: var(--hc-blue);
      line-height: 1.1;
    }
    .stat-label {
      font-size: 13px;
      color: #475569;
      margin-top: 6px;
      font-weight: 600;
    }

    /* GRID KARTU (Presensi/Agenda) */
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 18px;
    }
    .card {
      background: #fff;
      border: 1px solid #e2e8f0;
      border-radius: 14px;
      padding: 22px;
      box-shadow: 0 8px 22px rgba(15, 23, 42, .05);
      display: flex;
      flex-direction: column;
      min-height: 210px;
    }
    .card-title {
      margin: 0 0 10px 0;
      font-size: 18px;
      font-weight: 800;
      color: var(--hc-dark);
    }
    .card-desc {
      margin: 0;
      color: #475569;
      font-size: 14px;
      line-height: 1.6;
    }

    .card.dark {
      background: var(--hc-dark);
      border-color: rgba(255,255,255,.08);
      color: #fff;
    }
    .card.dark .card-title { color: #fff; }
    .card.dark .card-desc { color: rgba(255,255,255,.80); }

    .btn {
      margin-top: auto;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 800;
      font-size: 14px;
      text-decoration: none;
      transition: transform .15s ease, filter .15s ease;
      user-select: none;
    }
    .btn:hover { transform: translateY(-1px); filter: brightness(.98); }
    .btn.green { background: var(--hc-green); color: #fff; }
    .btn.outline {
      background: #fff;
      border: 1px solid rgba(26, 71, 135, .25);
      color: var(--hc-blue);
      font-weight: 800;
    }

    /* AGENDA LIST */
    .agenda-list { margin-top: 8px; }
    .agenda-item {
      display: block;
      padding: 12px 0;
      border-bottom: 1px solid #e2e8f0;
      text-decoration: none;
    }
    .agenda-item:last-child { border-bottom: none; }
    .agenda-meta {
      font-size: 12px;
      font-weight: 800;
      color: var(--hc-toska);
    }
    .agenda-title {
      margin-top: 2px;
      font-size: 14px;
      font-weight: 700;
      color: var(--hc-dark);
    }
    .placeholder {
      font-size: 14px;
      color: #94a3b8;
      margin: 0;
    }

    /* POSTS GRID */
    .posts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }
    .post-card {
      background: #fff;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid #e2e8f0;
      box-shadow: 0 10px 26px rgba(15, 23, 42, .06);
      text-decoration: none;
      transition: transform .15s ease;
      color: inherit;
    }
    .post-card:hover { transform: translateY(-2px); }
    .post-img {
      width: 100%;
      aspect-ratio: 4 / 3;
      object-fit: cover;
      background: #eef2f7;
      display: block;
    }
    .post-body { padding: 12px 14px 14px 14px; }
    .post-meta {
      font-size: 12px;
      font-weight: 800;
      color: var(--hc-toska);
      margin-bottom: 6px;
    }
    .post-title {
      font-size: 15px;
      font-weight: 800;
      color: var(--hc-dark);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 42px;
      line-height: 1.35;
    }
    .view-all {
      margin-top: 12px;
      text-align: right;
      font-size: 14px;
      font-weight: 800;
    }
    .view-all a { color: var(--hc-blue); text-decoration: none; }

    /* STRUKTUR */
    .people-list { display: flex; flex-direction: column; gap: 12px; margin-top: 8px; }
    .person {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      padding: 10px;
      border-radius: 12px;
    }
    .avatar {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      object-fit: cover;
      background: #e2e8f0;
      flex-shrink: 0;
    }
    .person-name { font-size: 14px; font-weight: 900; color: var(--hc-dark); }
    .person-role { font-size: 12px; font-weight: 800; color: var(--hc-toska); margin-top: 2px; }

    /* JOIN CARD */
    .join-card {
      background: var(--hc-dark);
      color: #fff;
      border-radius: 14px;
      padding: 22px;
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 10px 26px rgba(15, 23, 42, .08);
      display: flex;
      flex-direction: column;
      min-height: 240px;
    }
    .join-card .card-title { color: #fff; font-size: 20px; }
    .join-card .card-desc { color: rgba(255,255,255,.80); }
    .btn.blue { background: var(--hc-blue); color: #fff; }

    @media (max-width: 520px) {
      .hero { padding: 42px 18px; }
      .hero-title { font-size: 28px; }
    }
  </style>
</head>

<body>
  <div class="home-wrap">
    <!-- Header + Drawer + Footer akan di-inject oleh initHC32Navigation() -->

    <main id="hc32-home" class="hc32-container">
      <!-- HERO -->
      <section class="hero">
        <img
          class="hero-logo"
          src="https://lh3.googleusercontent.com/d/1lAev2D5Pxp5Rt36iy4y0YMibEnYu5BgI"
          alt="Logo History Club"
          loading="lazy"
        />
        <h1 class="hero-title">History Club SMAN 32 Jakarta</h1>
        <p class="hero-subtitle">HISTORY VICTORY! • HISTORIA DELECTAT</p>
        <div class="hero-actions">
          <a href="#join" class="hero-btn primary"><i class="ri-user-add-line"></i> Gabung Sekarang</a>
          <a href="#info" class="hero-btn secondary"><i class="ri-newspaper-line"></i> Lihat Postingan</a>
        </div>
      </section>

      <!-- STATS -->
      <section class="section">
        <div class="stats-grid">
          <div class="stat-card">
            <div id="stat-anggota" class="stat-number">…</div>
            <div class="stat-label">Anggota Siswa Aktif</div>
          </div>
          <div class="stat-card">
            <div id="stat-kegiatan" class="stat-number">…</div>
            <div class="stat-label">Kegiatan Selesai</div>
          </div>
          <div class="stat-card">
            <div id="stat-tahun" class="stat-number">…</div>
            <div class="stat-label">Tahun Berdiri</div>
          </div>
        </div>
      </section>

      <!-- PRESENSI + AGENDA -->
      <section class="section">
        <div class="grid-2">
          <div class="card dark">
            <h2 class="card-title">Presensi Kegiatan</h2>
            <p class="card-desc">Ada kegiatan hari ini? Jangan lupa lakukan presensi untuk mencatat kehadiran Anda.</p>
            <!-- Ubah link ini sesuai rute final kamu -->
            <a id="link-presensi" href="#" class="btn green"><i class="ri-qr-scan-2-line"></i> Buka Halaman Presensi</a>
          </div>

          <div class="card">
            <h2 class="card-title">Agenda Terdekat</h2>
            <div id="agenda-preview" class="agenda-list">
              <p class="placeholder">Memuat agenda…</p>
            </div>
            <!-- Ubah link ini sesuai rute final kamu -->
            <a id="link-agenda" href="https://sites.google.com/view/history-club-32/aktivitas/agenda" class="btn outline">
              <i class="ri-calendar-event-line"></i> Lihat Semua Agenda
            </a>
          </div>
        </div>
      </section>

      <!-- INFO & DOKUMENTASI -->
      <section id="info" class="section">
        <h2 class="section-title">Info & Dokumentasi</h2>

        <div id="posts-preview" class="posts-grid">
          <p class="placeholder" style="grid-column: 1 / -1;">Memuat posting…</p>
        </div>

        <div class="view-all">
          <!-- Ubah link ini sesuai halaman daftar postingan kamu -->
          <a id="link-all-posts" href="#">Lihat Semua Postingan →</a>
        </div>
      </section>

      <!-- STRUKTUR + JOIN -->
      <section id="join" class="section">
        <div class="grid-2">
          <div class="card">
            <h2 class="card-title">Pimpinan Klub</h2>
            <div id="pimpinan-preview" class="people-list">
              <p class="placeholder">Memuat pimpinan…</p>
            </div>

            <!-- Link sementara (kamu bisa ganti nanti) -->
            <a id="link-struktur" href="https://sites.google.com/view/history-club-32/profil/kepengurusan" class="btn outline">
              <i class="ri-team-line"></i> Lihat Struktur Lengkap
            </a>
            <a id="link-anggota" href="https://sites.google.com/view/history-club-32/keanggotaan/anggota" class="btn outline" style="margin-top:10px;">
              <i class="ri-group-line"></i> Lihat Daftar Anggota
            </a>
          </div>

          <div class="join-card">
            <h2 class="card-title">Gabung dengan Saksi Histori</h2>
            <p class="card-desc">Jadilah bagian dari kami untuk belajar, berdiskusi, dan menjuarai berbagai kompetisi sejarah.</p>
            <!-- Ubah link ini sesuai rute final kamu -->
            <a id="link-daftar" href="#" class="btn blue"><i class="ri-edit-2-line"></i> Daftar Sekarang</a>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Wajib: config.js dulu (hc32_post), lalu components.js (nav/status/modal) -->
  <script src="./config.js"></script>
  <script src="./components.js"></script>

  <script>
    // ====== SET LINK ROUTES (ubah sekali di sini) ======
    const ROUTES = {
      presensi: "/keanggotaan/presensi/",     // contoh rute tanpa .html
      daftar:   "/keanggotaan/pendaftaran/",  // contoh rute tanpa .html
      posts:    "/aktivitas/postingan/",      // contoh rute
    };

    const PLACEHOLDER_FOTO = "https://placehold.co/600x450/2e2e2e/ffffff?text=HC";

    function fmtTanggalID(dateStr) {
      try {
        const d = new Date(dateStr);
        return d.toLocaleDateString("id-ID", { day: "numeric", month: "short" });
      } catch { return ""; }
    }

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value;
    }

    function safeArr(x) { return Array.isArray(x) ? x : []; }

    function renderStats(anggotaData, kegiatanRiwayatData) {
      // Anggota siswa aktif
      const totalAnggota = safeArr(anggotaData?.data?.siswa).length;
      setText("stat-anggota", `${totalAnggota}+`);

      // Kegiatan selesai
      const totalKegiatan = safeArr(kegiatanRiwayatData?.data).length;
      setText("stat-kegiatan", `${totalKegiatan}+`);

      // Tahun berdiri (21 Nov 2019)
      const tahunBerdiri = 2019;
      const tahunSekarang = new Date().getFullYear();
      setText("stat-tahun", `${Math.max(0, tahunSekarang - tahunBerdiri)}+`);
    }

    function renderAgenda(kegiatanNextData) {
      const wrap = document.getElementById("agenda-preview");
      const data = safeArr(kegiatanNextData?.data);

      if (!wrap) return;

      if (data.length === 0) {
        wrap.innerHTML = `<p class="placeholder">Tidak ada agenda terdekat.</p>`;
        return;
      }

      wrap.innerHTML = "";
      data.slice(0, 3).forEach(item => {
        const tgl = (() => {
          try {
            return new Date(item.tanggal).toLocaleDateString("id-ID", { day: "numeric", month: "long" });
          } catch { return "Tanggal tidak tersedia"; }
        })();

        const a = document.createElement("a");
        a.className = "agenda-item";
        a.href = document.getElementById("link-agenda")?.href || "#";
        a.innerHTML = `
          <div class="agenda-meta">${tgl} • ${item.waktu || "Seharian"}</div>
          <div class="agenda-title"></div>
        `;
        a.querySelector(".agenda-title").textContent = item.judul || "Agenda";
        wrap.appendChild(a);
      });
    }

    function renderPosts(postingData) {
      const wrap = document.getElementById("posts-preview");
      const data = safeArr(postingData?.data);

      if (!wrap) return;

      if (data.length === 0) {
        wrap.innerHTML = `<p class="placeholder" style="grid-column:1/-1;">Belum ada postingan.</p>`;
        return;
      }

      wrap.innerHTML = "";
      data.slice(0, 3).forEach(p => {
        const a = document.createElement("a");
        a.className = "post-card";

        // kalau backend punya link/slug, pakai itu. kalau tidak, lempar ke halaman list.
        const fallback = ROUTES.posts || "#";
        a.href = p.link || fallback;

        const meta = `${fmtTanggalID(p.tanggal)}${p.kategori ? " • " + p.kategori : ""}`.trim();

        a.innerHTML = `
          <img class="post-img" alt="" loading="lazy" />
          <div class="post-body">
            <div class="post-meta"></div>
            <div class="post-title"></div>
          </div>
        `;

        const img = a.querySelector(".post-img");
        img.src = p.gambar || PLACEHOLDER_FOTO;
        img.alt = p.judul || "Postingan";

        a.querySelector(".post-meta").textContent = meta || "Postingan";
        a.querySelector(".post-title").textContent = p.judul || "Judul Postingan";

        wrap.appendChild(a);
      });
    }

    function renderPimpinan(strukturData) {
      const wrap = document.getElementById("pimpinan-preview");
      const data = safeArr(strukturData?.data);

      if (!wrap) return;

      const pimpinan = data
        .filter(item => {
          const jab = String(item.jabatan || "").toLowerCase();
          return jab.includes("ketua") || jab.includes("wakil");
        })
        .slice(0, 3);

      if (pimpinan.length === 0) {
        wrap.innerHTML = `<p class="placeholder">Data pimpinan belum diisi.</p>`;
        return;
      }

      wrap.innerHTML = "";
      pimpinan.forEach(p => {
        const div = document.createElement("div");
        div.className = "person";
        div.innerHTML = `
          <img class="avatar" alt="" loading="lazy" />
          <div>
            <div class="person-name"></div>
            <div class="person-role"></div>
          </div>
        `;
        const img = div.querySelector(".avatar");
        img.src = p.foto || PLACEHOLDER_FOTO;
        img.alt = p.nama || "Pimpinan";

        div.querySelector(".person-name").textContent = p.nama || "Nama";
        div.querySelector(".person-role").textContent = p.jabatan || "Jabatan";
        wrap.appendChild(div);
      });
    }

    async function initHomepage() {
      // Pasang nav/header/footer
      initHC32Navigation("beranda");

      // Set link sekali di sini (biar kamu nggak edit satu-satu)
      const lp = document.getElementById("link-presensi");
      if (lp && ROUTES.presensi) lp.href = ROUTES.presensi;

      const ld = document.getElementById("link-daftar");
      if (ld && ROUTES.daftar) ld.href = ROUTES.daftar;

      const allPosts = document.getElementById("link-all-posts");
      if (allPosts && ROUTES.posts) allPosts.href = ROUTES.posts;

      // Loading overlay global dari components.js
      showHC32Status("loading", "Memuat Beranda", "Sedang mengambil data terbaru…");

      // Ambil data paralel (pakai hc32_post dari config.js)
      const tasks = await Promise.allSettled([
        hc32_post("getDaftarAnggotaPublik"),
        hc32_post("getKegiatanPublik", { mode: "riwayat" }),
        hc32_post("getKegiatanPublik", { mode: "next" }),
        hc32_post("getPostingPublik", {}),
        hc32_post("getStrukturKepengurusanPublik"),
      ]);

      const pick = (i) => (tasks[i]?.status === "fulfilled" ? tasks[i].value : null);

      const anggotaData = pick(0);
      const kegiatanRiwayatData = pick(1);
      const kegiatanNextData = pick(2);
      const postingData = pick(3);
      const strukturData = pick(4);

      // Render (kalau ada yang gagal, section lain tetap jalan)
      try { renderStats(anggotaData || {}, kegiatanRiwayatData || {}); } catch {}
      try { renderAgenda(kegiatanNextData || {}); } catch {}
      try { renderPosts(postingData || {}); } catch {}
      try { renderPimpinan(strukturData || {}); } catch {}

      // Kalau semuanya gagal, tampilkan error
      const allFailed = tasks.every(t => t.status === "rejected");
      if (allFailed) {
        showHC32Status("error", "Gagal Memuat Data", "Periksa koneksi / Apps Script / izin akses.");
      } else {
        hideHC32Status();
      }
    }

    document.addEventListener("DOMContentLoaded", initHomepage);
  </script>
</body>
</html>
