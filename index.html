<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beranda - History Club SMAN 32 Jakarta</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Warna dari Brand Guide */
            --hc-blue: #1a4787;
            --hc-toska: #0f8a94;
            --hc-dark: #2e2e2e;
            --hc-green: #15a256;
            --hc-red: #d30e14;
            --hc-bg: #e7e9ea;
            --hc-blue-light-bg: rgba(26, 71, 135, 0.08);
        }

        @keyframes hcspin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        body {
            font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', sans-serif;
            background-color: #f8fafc; /* Latar belakang netral */
            color: var(--hc-dark);
            margin: 0;
            padding: 0;
        }

        /* Wrapper Konten Utama */
        .hc-container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 24px 16px;
        }
        
        section {
            margin-top: 48px;
        }
        
        /* Judul Section Umum */
        .hc-section-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--hc-dark);
            margin: 0 0 20px 0;
            text-align: center;
        }

        /* ==================================
           1. Loading Spinner (Full Screen)
           ================================== */
        #hc32-loading-overlay {
            position: fixed; /* Full Screen */
            inset: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(2px);
            display: flex; /* Tampil di awal */
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .hc-loader {
            position: relative;
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hc-loader-spinner {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            border: 5px solid var(--hc-blue);
            border-top-color: var(--hc-toska);
            animation: hcspin 1s linear infinite;
        }
        .hc-loader-logo {
            width: 44px;
            height: 44px;
            border-radius: 50%;
        }

        /* ==================================
           2. Hero Section
           ================================== */
        .hero-section {
            background-image: linear-gradient(90deg, var(--hc-blue) 0%, var(--hc-toska) 100%);
            border-radius: 16px;
            padding: 48px 28px;
            color: white;
            text-align: center;
            box-shadow: 0 10px 30px rgba(26, 71, 135, 0.2);
        }
        .hero-title {
            margin: 0;
            font-size: 32px;
            font-weight: 700; /* Poppins Bold */
            letter-spacing: .02em;
        }
        .hero-subtitle {
            margin: 10px 0 24px 0;
            font-size: 16px;
            opacity: 0.9;
        }
        .hero-cta {
            display: inline-block;
            background: white;
            color: var(--hc-blue);
            padding: 12px 24px;
            border-radius: 999px;
            font-weight: 600;
            font-size: 15px;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        .hero-cta:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* ==================================
           3. Stats Section
           ================================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            text-align: center;
        }
        .stat-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
        }
        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: var(--hc-blue);
        }
        .stat-label {
            font-size: 14px;
            color: #475569;
            margin-top: 4px;
        }

        /* ==================================
           4. Preview Grid (Presensi & Agenda)
           ================================== */
        .preview-grid-pa {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .preview-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(15, 23, 42, .05);
            display: flex;
            flex-direction: column;
        }
        .preview-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--hc-dark);
            margin: 0 0 16px 0;
        }
        /* Style khusus untuk CTA Presensi */
        .presensi-cta {
            background-color: var(--hc-dark);
            color: white;
        }
        .presensi-cta .preview-title {
            color: white;
        }
        .presensi-cta p {
            flex-grow: 1; /* Dorong tombol ke bawah */
        }
        .presensi-cta-button {
            display: block;
            text-align: center;
            background: var(--hc-green);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            text-decoration: none;
            transition: background-color 0.2s;
            margin-top: 16px;
        }
        .presensi-cta-button:hover {
            background-color: #118a4a;
        }
        
        /* Style untuk list Agenda */
        .agenda-item {
            display: block;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
            text-decoration: none;
        }
        .agenda-item:last-child { border-bottom: none; }
        .agenda-item-tanggal {
            font-size: 13px;
            font-weight: 600;
            color: var(--hc-toska);
        }
        .agenda-item-judul {
            font-size: 15px;
            font-weight: 500;
            color: var(--hc-dark);
            margin-top: 2px;
        }
        .placeholder-text {
            font-size: 14px;
            color: #94a3b8;
        }

        /* ==================================
           5. Preview Info & Dokumentasi
           ================================== */
        
        /* PERUBAHAN UI DI SINI */
        
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .post-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(15, 23, 42, .06);
            overflow: hidden;
            border: 1px solid #e2e8f0;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        .post-card:hover { transform: translateY(-3px); }
        .post-card-img {
            width: 100%;
            /* Hapus height: 180px; */
            aspect-ratio: 4 / 3; /* Beri rasio aspek agar rapi */
            object-fit: cover;
            background-color: var(--hc-bg);
            border-bottom: 1px solid #e2e8f0;
        }
        .post-card-content { padding: 14px 16px 16px 16px; }
        
        /* BARU: Meta (Tanggal/Kategori) */
        .post-card-meta {
            font-size: 12px;
            font-weight: 500;
            color: var(--hc-toska);
            margin-bottom: 4px;
        }
        
        .post-card-title {
            font-weight: 600;
            font-size: 16px;
            color: var(--hc-dark);
            /* Hapus margin-bottom */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;  
            overflow: hidden;
            min-height: 48px; /* Jaga 2 baris */
        }
        .post-card-isi {
           display: none; /* Sembunyikan isi agar mirip inspirasi */
        }
        .view-all-link {
            text-align: right;
            margin-top: 16px;
            font-size: 14px;
            font-weight: 500;
        }
        .view-all-link a {
            color: var(--hc-blue);
            text-decoration: none;
        }

        /* ==================================
           6. Preview Struktur & Join
           ================================== */
        .struktur-join-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
             gap: 20px;
        }
        
        /* Preview Pimpinan */
        .struktur-preview-list { display: flex; flex-direction: column; gap: 12px; }
        .struktur-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 10px;
            border-radius: 8px;
        }
        .struktur-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            background: var(--hc-bg);
        }
        .struktur-nama { font-size: 15px; font-weight: 600; color: var(--hc-dark); }
        .struktur-jabatan { font-size: 13px; color: var(--hc-toska); font-weight: 500; }
        
        /* Tombol Link Halaman */
        .cta-button-outline {
            display: block; /* Tombol full width */
            text-align: center;
            margin-top: 16px;
            background: white;
            border: 1px solid var(--hc-blue);
            color: var(--hc-blue);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            text-decoration: none;
            transition: all 0.2s;
        }
        .cta-button-outline:hover { background: var(--hc-blue-light-bg); }

        /* Card Join (Inspirasi image_bf16a1.jpg) */
        .join-card {
            background: var(--hc-dark);
            color: white;
            border-radius: 12px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 250px; /* Samakan tinggi */
        }
        .join-card .preview-title {
            color: white;
            font-size: 22px;
        }
        .join-card p {
            color: var(--hc-bg);
            opacity: 0.9;
            flex-grow: 1;
        }
        .join-cta-button {
             display: block; 
             text-align: center;
             background: var(--hc-blue);
             color: white;
             padding: 10px 20px;
             border-radius: 8px;
             font-weight: 600;
             font-size: 15px;
             text-decoration: none;
             transition: all 0.2s;
        }
        .join-cta-button:hover {
            background-color: var(--hc-blue-light);
        }

        /* ==================================
           7. Footer
           ================================== */
        #hc32-footer {
            background: var(--hc-dark); /* */
            color: white;
            text-align: center;
            padding: 20px 10px;
            width: 100vw;
            position: relative;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 80px;
        }
        #hc32-footer .footer-sub {
            font-size: 12px; 
            margin-top: 4px; 
            color: var(--hc-bg); /* */
            opacity: 0.8;
        }

    </style>
</head>
<body>

    <div id="hc32-loading-overlay">
        <div class="hc-loader">
            <div class="hc-loader-spinner"></div>
            <img src="https://lh3.googleusercontent.com/d/1lAev2D5Pxp5Rt36iy4y0YMibEnYu5BgI" class="hc-loader-logo" alt="Logo HC">
        </div>
    </div>

    <div class="hc-container">
        <section class="hero-section">
            <h1 class="hero-title">History Club SMAN 32 Jakarta</h1>
            <p class="hero-subtitle">HISTORY VICTORY! • HISTORIA DELECTAT</p>
            <a href="#" class="hero-cta">Gabung Sekarang →</a>
        </section>
    </div>

    <main id="hc32-homepage">

        <div class="hc-container">
            <section class="stats-grid">
                <div class="stat-item">
                    <div id="stat-anggota" class="stat-number">...</div>
                    <div class="stat-label">Anggota Siswa Aktif</div>
                </div>
                <div class="stat-item">
                    <div id="stat-kegiatan" class="stat-number">...</div>
                    <div class="stat-label">Kegiatan Selesai</div>
                </div>
                <div class="stat-item">
                    <div id="stat-tahun" class="stat-number">...</div>
                    <div class="stat-label">Tahun Berdiri</div>
                </div>
            </section>
        </div>

        <div class="hc-container">
            <section class="preview-grid-pa">
                <div class="preview-card presensi-cta">
                    <h2 class="preview-title">Presensi Kegiatan</h2>
                    <p>Ada kegiatan hari ini? Jangan lupa lakukan presensi untuk mencatat kehadiran Anda.</p>
                    <a href="https://mickoegi.github.io/presensihc/presensi.html" class="presensi-cta-button">Buka Halaman Presensi</a>
                </div>
                <div class="preview-card">
                    <h2 class="preview-title">Agenda Terdekat</h2>
                    <div id="agenda-preview-list">
                        <p class="placeholder-text">Memuat agenda...</p>
                    </div>
                    <a href="https://sites.google.com/view/history-club-32/aktivitas/agenda" class="cta-button-outline" style="margin-top: 16px;">Lihat Semua Agenda</a>
                </div>
            </section>
        </div>

        <div class="hc-container">
            <section>
                <h2 class="hc-section-title">Info & Dokumentasi</h2>
                <div id="posts-preview-list" class="posts-grid">
                    <p class="placeholder-text" style="grid-column: 1 / -1;">Memuat posting...</p>
                </div>
                <div class="view-all-link">
                    <a href="#">Lihat Semua Postingan →</a>
                </div>
            </section>
        </div>

        <div class="hc-container">
            <section class="struktur-join-grid">
                <div class="preview-card">
                    <h2 class="preview-title">Pimpinan Klub</h2>
                    <div id="struktur-preview-list" class="struktur-preview-list">
                        <p class="placeholder-text">Memuat pimpinan...</p>
                    </div>
                    <a href="https://sites.google.com/view/history-club-32/profil/kepengurusan" class="cta-button-outline">Lihat Struktur Lengkap</a>
                    <a href="https://sites.google.com/view/history-club-32/keanggotaan/anggota" class="cta-button-outline" style="margin-top: 10px;">Lihat Daftar Anggota</a>
                </div>
                <div class="preview-card join-card">
                    <h2 class="preview-title">Gabung dengan Saksi Histori</h2>
                    <p>Jadilah bagian dari kami untuk belajar, berdiskusi, dan menjuarai berbagai kompetisi sejarah.</p>
                    <a href="#" class="join-cta-button">Daftar Sekarang</a>
                </div>
            </section>
        </div>

    </main>

    <div id="hc32-footer">
        <div style="font-size: 13px;">© 2025 History Club SMAN 32 Jakarta. All rights reserved.</div>
        <div class="footer-sub">
            Dibuat dan dikembangkan oleh <span style="font-weight: 600; color: white;">@vitezegi</span>.
        </div>
    </div>


    <script>
        // URL Apps Script Anda
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz22NwYQ-WJwmdieMgzQxw1I2lXKTghebFO-oSY-wE_av-3oEYIi9TfSCqJCpy3iZKt/exec";
        const LOADER = document.getElementById("hc32-loading-overlay");
        const PLACEHOLDER_FOTO = "https://placehold.co/200x200/2e2e2e/ffffff?text=HC";

        // Fungsi helper untuk fetch
        async function fetchData(action, params = {}) {
            const res = await fetch(WEB_APP_URL, {
                method: "POST",
                body: JSON.stringify({ action, ...params })
            });
            return res.json();
        }

        // Render Stats (Angka)
        function renderStats(anggotaData, kegiatanData) {
            try {
                const totalAnggota = anggotaData.data.siswa.length || 0;
                document.getElementById("stat-anggota").textContent = `${totalAnggota}+`;
            } catch (e) { document.getElementById("stat-anggota").textContent = "0+"; }

            try {
                const totalKegiatan = kegiatanData.data.length || 0;
                document.getElementById("stat-kegiatan").textContent = `${totalKegiatan}+`;
            } catch (e) { document.getElementById("stat-kegiatan").textContent = "0+"; }
            
            try {
                // Data dari Anda: 21 November 2019
                const tahunBerdiri = 2019;
                const tahunSekarang = new Date().getFullYear();
                document.getElementById("stat-tahun").textContent = `${tahunSekarang - tahunBerdiri}+`;
            } catch (e) { document.getElementById("stat-tahun").textContent = "N/A"; }
        }

        // Render Preview Agenda
        function renderAgenda(kegiatanNextData) {
            const listEl = document.getElementById("agenda-preview-list");
            if (!kegiatanNextData.data || kegiatanNextData.data.length === 0) {
                listEl.innerHTML = `<p class="placeholder-text">Tidak ada agenda terdekat.</p>`;
                return;
            }
            listEl.innerHTML = ""; // Kosongkan
            // Ambil 3 agenda terdekat
            kegiatanNextData.data.slice(0, 3).forEach(item => {
                const tgl = new Date(item.tanggal).toLocaleDateString('id-ID', {
                    day: 'numeric', month: 'long'
                });
                const a = document.createElement("a");
                a.className = "agenda-item";
                a.href = "https://sites.google.com/view/history-club-32/aktivitas/agenda"; 
                a.innerHTML = `
                    <div class="agenda-item-tanggal">${tgl} • ${item.waktu || 'Seharian'}</div>
                    <div class="agenda-item-judul">${item.judul}</div>
                `;
                listEl.appendChild(a);
            });
        }

        /* ==================================
           PERUBAHAN JAVASCRIPT DI SINI
           ================================== */

        // Render Preview Posting (Info & Dok)
        function renderPosts(postingData) {
            const listEl = document.getElementById("posts-preview-list");
            if (!postingData.data || postingData.data.length === 0) {
                listEl.innerHTML = `<p class="placeholder-text" style="grid-column: 1 / -1;">Belum ada postingan.</p>`;
                return;
            }
            listEl.innerHTML = ""; // Kosongkan
            // Ambil 3 postingan terbaru
            postingData.data.slice(0, 3).forEach(p => {
                const card = document.createElement("a");
                card.className = "post-card";
                card.href = "#"; // Ganti dengan link ke halaman info/postingan
                
                // Format tanggal
                let meta = p.kategori || '';
                try {
                    // Format: 7 Nov • hasil-kegiatan
                    const tgl = new Date(p.tanggal).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
                    meta = `${tgl} • ${p.kategori}`;
                } catch(e) {}

                card.innerHTML = `
                    <img src="${p.gambar || PLACEHOLDER_FOTO}" alt="${p.judul}" class="post-card-img">
                    <div class="post-card-content">
                        <div class="post-card-meta">${meta}</div>
                        <div class="post-card-title">${p.judul}</div>
                        </div>
                `;
                listEl.appendChild(card);
            });
        }
        
        // Render Preview Pimpinan/Struktur
        function renderStruktur(strukturData) {
            const listEl = document.getElementById("struktur-preview-list");
            if (!strukturData.data || strukturData.data.length === 0) {
                listEl.innerHTML = `<p class="placeholder-text">Data pimpinan belum diisi.</p>`;
                return;
            }
            
            // Filter hanya Pimpinan (Ketua & Wakil)
            const pimpinan = strukturData.data.filter(item => {
                const jab = (item.jabatan || "").toLowerCase();
                return jab.includes("ketua") || jab.includes("wakil");
            }).slice(0, 3); // Ambil maks 3

            if (pimpinan.length === 0) {
                listEl.innerHTML = `<p class="placeholder-text">Data pimpinan belum diisi.</p>`;
                return;
            }

            listEl.innerHTML = ""; // Kosongkan
            pimpinan.forEach(p => {
                const div = document.createElement("div");
                div.className = "struktur-profile";
                div.innerHTML = `
                    <img src="${p.foto || PLACEHOLDER_FOTO}" alt="${p.nama}" class="struktur-avatar">
                    <div>
                        <div class="struktur-nama">${p.nama}</div>
                        <div class="struktur-jabatan">${p.jabatan}</div>
                    </div>
                `;
                listEl.appendChild(div);
            });
        }

        // Fungsi Utama untuk memuat semua data
        async function initHomepage() {
            try {
                // Ambil semua data secara paralel
                const [
                    anggotaData, 
                    kegiatanRiwayatData, 
                    kegiatanNextData, 
                    postingData, 
                    strukturData
                ] = await Promise.all([
                    fetchData("getDaftarAnggotaPublik"),
                    fetchData("getKegiatanPublik", { mode: "riwayat" }), // Untuk stats
                    fetchData("getKegiatanPublik", { mode: "next" }),    // Untuk preview agenda
                    fetchData("getPostingPublik", {}), // Ambil semua postingan terbaru
                    fetchData("getStrukturKepengurusanPublik")
                ]);

                // Render semua bagian
                renderStats(anggotaData, kegiatanRiwayatData);
                renderAgenda(kegiatanNextData);
                renderPosts(postingData);
                renderStruktur(strukturData);

            } catch (err) {
                console.error("Gagal memuat data homepage:", err);
                // Tampilkan error di salah satu placeholder
                document.getElementById("agenda-preview-list").innerHTML = 
                    `<p class="placeholder-text" style="color:var(--hc-red);">Gagal memuat data.</p>`;
            } finally {
                LOADER.style.display = 'none'; // Selalu sembunyikan loading
            }
        }

        // Mulai!
        initHomepage();
    </script>
</body>
</html>
